generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int          @id @default(autoincrement())
  email        String       @unique
  password     String
  nombre       String
  apellido     String
  telefono     String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  autos        Auto[]
  cotizaciones Cotizacion[]
  noticias     Noticia[]

  @@map("users")
}

model Auto {
  id           Int          @id @default(autoincrement())
  userId       Int
  marca        String
  modelo       String
  ano          Int          @map("a√±o")
  kilometraje  Int?
  descripcion  String?
  precio       Float?
  color        String?
  combustible  String?
  imagenUrl    String?
  estado       String       @default("activo")
  imagenes     String[]
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  cotizaciones Cotizacion[]
  noticias     Noticia[]

  @@index([userId])
  @@index([marca, modelo])
  @@index([estado])
  @@map("autos")
}

model Cotizacion {
  id             Int      @id @default(autoincrement())
  userId         Int?
  autoId         Int?
  marca          String?
  modelo         String?
  ano            Int?
  tipoSeguro     String?
  cobertura      String?
  valorAsegurado Float
  primaMensual   Float
  primaAnual     Float?
  uso            String?
  estado         String   @default("pendiente")
  createdAt      DateTime @default(now())
  auto           Auto?    @relation(fields: [autoId], references: [id])
  user           User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@map("cotizaciones")
}

model Noticia {
  id               Int      @id @default(autoincrement())
  titulo           String
  contenido        String
  resumen          String?
  autoId           Int?
  userId           Int?
  imagenUrl        String?
  tags             String[]
  publicado        Boolean  @default(true)
  fechaPublicacion DateTime @default(now())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  auto             Auto?    @relation(fields: [autoId], references: [id])
  user             User?    @relation(fields: [userId], references: [id])

  @@index([fechaPublicacion])
  @@index([publicado])
  @@map("noticias")
}

model SolicitudSeguro {
  id            Int             @id @default(autoincrement())
  clienteNombre String?
  tipoVehiculo  String          @default("auto")
  marca         String
  modelo        String
  ano           Int
  whatsapp      String
  tokenAsesor   String          @unique @default(uuid())
  tokenCliente  String          @unique @default(uuid())
  estado        EstadoSolicitud @default(NUEVA)
  fotos         String[]
  observaciones String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  chasis        String?
  motor         String?
  patente       String?

  @@index([tokenAsesor])
  @@index([tokenCliente])
  @@index([estado])
  @@map("solicitudes_seguro")
}

enum EstadoSolicitud {
  NUEVA
  VISTA_POR_ASESOR
  FOTOS_SOLICITADAS
  FOTOS_SUBIDAS
  COTIZADO
  CERRADA
}
